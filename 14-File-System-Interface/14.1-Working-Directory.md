# 14.1 Working Directory 工作目录

> Each process has associated with it a directory, called its current working directory or simply working directory, that is used in the resolution of relative file names (see Section 11.2.2 [File Name Resolution], page 264).

每个进程都一个与之相关联的目录，叫做当前工作目录或者简称为工作目录，用于解析相对文件名（见第264页第11.2.2节[文件名解析]）

> When you log in and begin a new session, your working directory is initially set to the home directory associated with your login account in the system user database. You can find any user’s home directory using the getpwuid or getpwnam functions; see Section 30.13 [User Database], page 865.

当你登录并开启一个新的会话时，你的工作目录会被初始化设置成系统用户数据库中与登录用户关联的家目录。你可以通过`getpwuid`或者`getpwnam`函数来找到任意一个用户的家目录；请参阅第30.13节[用户数据库]，第865页。

> Users can change the working directory using shell commands like cd. The functions described in this section are the primitives used by those commands and by other programs for examining and changing the working directory. Prototypes for these functions are declared in the header file unistd.h.

用户可以通过shell命令，如`cd`来切换工作目录。本节中描述的函数是使用这些命令和其他程序用于检查和更改工作目录的原语。这些函数的声明在头文件`unistd.h`中。

> char * getcwd (char *buffer, size t size) [Function]

**char * getcwd (char *buffer, size t size) [Function]**

> Preliminary: | MT-Safe | AS-Unsafe heap | AC-Unsafe mem fd | See Section 1.2.2.1 [POSIX Safety Concepts], page 2.

[-不知道怎么翻译-]

> The getcwd function returns an absolute file name representing the current working directory, storing it in the character array buffer that you provide. The size argument is how you tell the system the allocation size of buffer.

函数`getcwd`返回一个表示当前工作目录的绝对文件名，并将其存储在一个您提供的字符数组缓冲区中。size参数告诉徐通分配的缓冲区大小。

> The GNU C Library version of this function also permits you to specify a null pointer for the buffer argument. Then getcwd allocates a buffer automatically, as with malloc (see Section 3.2.3 [Unconstrained Allocation], page 45). If the size is greater than zero, then the buffer is that large; otherwise, the buffer is as large as necessary to hold the result.

这个函数的GNUC库版本还允许你对于buffer参数指定一个空指针，然后`getcwd`自动通过分配一个buffer，就像malloc一样（参见第45页第3.2.3节[无约束分配]）如果`size`大于0，那么缓冲区就那么大，否则，缓冲区就与保存结果所需要的大小一样大。

> The return value is buffer on success and a null pointer on failure. The following errno error conditions are defined for this function:

返回值在成功的情况下，是buffer指针，失败的情况下是一个空指针。下面是这个函数所定义的错误情况下的错误码`errno`

> EINVAL The size argument is zero and buffer is not a null pointer.
> ERANGE The size argument is less than the length of the working directory name. You need to allocate a bigger array and try again.
> EACCES Permission to read or search a component of the file name was denied.

EINVAL: size参数是0并且buffer不是一个空指针
ERANGE: size参数小于工作路径名的长度，你需要分配一个大一些的数组，并重新尝试
EACCES: 没有读取或者搜索文件名某个组件的权限

> You could implement the behavior of GNU’s getcwd (NULL, 0) using only the standard behavior of getcwd:

你可以仅使用getcwd的标准行为来实现GNU的getcwd(NULL, 0):

```c
gnu_getcwd ()
{
	size_t size = 100;
	while (1)
	{
		char *buffer = (char *) xmalloc (size);
		if (getcwd (buffer, size) == buffer)
			return buffer;
		free (buffer);
		if (errno != ERANGE)
			return 0;
	size *= 2;
	}
}
```

> See Section 3.2.3.2 [Examples of malloc], page 46, for information about xmalloc, which is not a library function but is a customary name used in most GNU software.

请参阅第46页第3.2.3.2节[malloc示例]，了解有关xmalloc的信息，xmalloc不是库函数，但是是多数GNU软件中使用的。

> char * getwd (char *buffer) [Deprecated Function]

__char * getwd (char *buffer) [不推荐的函数]__

> Preliminary: | MT-Safe | AS-Unsafe heap i18n | AC-Unsafe mem fd | See
> Section 1.2.2.1 [POSIX Safety Concepts], page 2.



> This is similar to getcwd, but has no way to specify the size of the buffer. The GNU C Library provides getwd only for backwards compatibility with BSD.

这与getcwd类似，但是没有办法指定buffer的大小，GNUC库仅为向后兼容BSD提供getwd。

> The buffer argument should be a pointer to an array at least PATH_MAX bytes long (see Section 32.6 [Limits on File System Capacity], page 904). On GNU/Hurd systems there is no limit to the size of a file name, so this is not necessarily enough space to contain the directory name. That is why this function is deprecated.

buffer参数应该是一个只想数组的指针，长度至少PATH_MAX字节（请参阅第32.6节[文件系统容量限制]，第904页）。在GNU/Hurd系统中，没有对文件名字大小的限制，所以不一定有足够的空间容纳目录名。这就是为什么这个函数被弃用的原因。

> char * get_current_dir_name (void) [Function]

__char * get_current_dir_name (void) [函数]__

> Preliminary: | MT-Safe env | AS-Unsafe heap | AC-Unsafe mem fd | See Section 1.2.2.1 [POSIX Safety Concepts], page 2.

> The get_current_dir_name function is basically equivalent to getcwd (NULL, 0), except the value of the PWD environment variable is first examined, and if it does in fact correspond to the current directory, that value is returned. This is a subtle difference which is visible if the path described by the value in PWD is using one or more symbolic links, in which case the value returned by getcwd would resolve the symbolic links and therefore yield a different result.
> This function is a GNU extension.

`get_current_dir_name`函数是基本等同于`getcwd(NULL, 0)`,只是首先检查环境变量`PWD`的值，如果它确实对应于当前目录，就返回这个值。如果PWD中的值所描述的路径使用一个或多个符号链接，那么这是一个细微的差别，在这种情况下，getcwd返回的值解析符号链接，从而产生不同的结果。

这个函数是GNUC扩展。

> int chdir (const char *filename) [Function]

__int chdir (const char *filename) [函数]__

> Preliminary: | MT-Safe | AS-Safe | AC-Safe | See Section 1.2.2.1 [POSIX Safety
> Concepts], page 2.



> This function is used to set the process’s working directory to filename.
>
> The normal, successful return value from chdir is 0. A value of -1 is returned to indicate an error. The errno error conditions defined for this function are the usual file name syntax errors (see Section 11.2.3 [File Name Errors], page 264), plus ENOTDIR if the file filename is not a directory.

这个函数用于将进程的工作目录设置为filename。

chdir函数一般的，正常的返回值是0.返回值-1表示发生了错误。该函数的errno定义，通常是filename语法错误（见第264页11.2.3节[文件名错误]），如果filename不是路径，返回ENOTDIR

> int fchdir (int filedes) [Function]

__int fchdir (int filedes) [函数]__

> Preliminary: | MT-Safe | AS-Safe | AC-Safe | See Section 1.2.2.1 [POSIX Safety
> Concepts], page 2.

> This function is used to set the process’s working directory to directory associated with the file descriptor filedes.

此函数用于将进程的工作目录设置为与文件描述符fileds关联的目录

> The normal, successful return value from fchdir is 0. A value of -1 is returned to indicate an error. The following errno error conditions are defined for this function:

fchdir的正常、成功的情况下，返回值为0。返回值-1表示错误，此函数定义了一下errno的情况：

> EACCES Read permission is denied for the directory named by dirname.
> EBADF The filedes argument is not a valid file descriptor.
> ENOTDIR The file descriptor filedes is not associated with a directory.
> EINTR The function call was interrupt by a signal.
> EIO An I/O error occurred.

- EACCES 没有读取dirname对应目录的权限
- EBADF 参数fileds是一个无效的文件描述符
- ENOTDIR 文件描述符关联的不是目录
- EINTR 函数调用被信号打断
- EIO 发生了一个IO错误